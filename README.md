# Catégorisation des produits d'un boutique en ligne

Fourni une API permettant de prédire la catégorie d'un produit en fonction de sa désignation, description et d'une image.

## Structure du projet

E-COMMERCE-MLOPS/  
├── .github/workflows : Github Actions  
├── backend/ : API et modèle de prédiction  
├── frontend/ : (plus tard) application WEB pour interagir avec l'API  
└── scripts/ : liste des scripts permettant de lancer les tests ou de faire le déploiement  

## Backend

### Configuration de l'environnement de développement

Un conteneur de développement a été préparé.  
Voici les prérequis : 
- [Visual Studio Code](https://code.visualstudio.com) 
- Extension VSCode [Docker](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker)
- Extension VSCode [Dev Container](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers)
- [Docker Desktop](https://www.docker.com/products/docker-desktop/)

Une fois les extensions installées, veuillez-suivre les étapes suivantes :  
1. Ouvrir le projet dans VSCode.
2. Cloner le repo e-commerce-mlops sur le terminal et placer vous dans le dossier. 
3. Ouvrir la palette des commandes (Cmd+Shift+p).
4. Saisir **dev container open** et sélectionner l'option **Dev Containers: Open folder in Container...**.
5. Sélectionner le dossier **backend**.

La fenêtre de VSCode va se rouvrir. Dans le terminal, vous pourrez constater l'installation des packages.

### Lancement de l'API

L'API utilise **uvicorn** comme serveur Web.  
Pour démarrer le serveur et observer les changements, exécuter la commande suivante dans le terminal du conteneur de développement :

```shell
uvicorn app.main:app --reload
```

VSCode doit faire automatiquement la redirection du port 8000.  
Ouvrir l'addresse ci-dessous dans un navigateur Web sur la machine hôte pour afficher la documentation :

http://127.0.0.1:8000/docs

## Normes de développement

### Commentaires

Doivent être rédigés en anglais.

### Git

#### Pull Request
Les PR doivent obligatoirement être liées à une issue et avoir une description permettant d'aider le validateur dans ses tests.

#### Messages de commit

Doivent être rédigés en anglais et respecter le format ci-dessous :

```
Short (72 chars or less) summary

More detailed explanatory text. Wrap it to 72 characters. The blank
line separating the summary from the body is critical (unless you omit
the body entirely).

Write your commit message in the imperative: "Fix bug" and not "Fixed
bug" or "Fixes bug." This convention matches up with commit messages
generated by commands like git merge and git revert.

Further paragraphs come after blank lines.

- Bullet points are okay, too.
- Typically a hyphen or asterisk is used for the bullet, followed by a
  single space. Use a hanging indent.
```

Exemple de message de commit :

```
Add CPU arch filter scheduler support

In a mixed environment of…
```

### Python

Le dev container est configuré pour installer et configurer automatiquement les extensions VSCode. 

#### Language server : Pylance

Parfois, Pylance indique des erreurs de type à cause de décorateurs des librairies. C'est le cas notamment de la propriété `__tablename__` de SQLAchemy.

Pour ignorer ces erreurs, ajouter le commentaire suivant en bout de ligne :
```python
__tablename__ = "prediction_feedback" # type: ignore
```

#### Docstring : Google

Nous utilisons la convention de [Google expliquée ici](https://google.github.io/styleguide/pyguide.html#s3.8-comments-and-docstrings).

L'extension autoDocstring, intégrée au dev container, permet de générer les templates de docstring via la commande (Cmd + Shift + p) `Generate Docstring`.

#### Linter : Pylint

**Pylint analyse le contenu du fichier après la sauvegarde de celui-ci.**

Parfois, Pylint fait des recommandation erronée. C'est le cas, par exemple, des validateurs de la librairie Pydantic :

```python
# Pylint(E0213:no-self-argument): Method 'assemble_db_connection' should have "self" as first argument
@validator("SQLALCHEMY_DATABASE_URI", pre=True)
    def assemble_db_connection(cls, v: str | None, values: Dict[str, Any]) -> Any:
```

La désactivation des remarques de Pylint se fait via un commentaire formaté.   
Celui-ci commence par `pylint: disable=`, suivi par la(les) références de(s) remarque(s). 

- Pour désactiver une remarque sur une ligne seulement, on ajoute le commentaire sur la même ligne.
- Pour désactiver toutes les remarques d'un scope, on ajoute le commentaire sur une nouvelle ligne dans le scope. Attention, seule les lignes en dessous du commentaire seront ignorée.

```python
# Désactive la remarque E0213 seulement pour la ligne ci-dessous
@validator("SQLALCHEMY_DATABASE_URI", pre=True) # pylint: disable=E0213

# Désactive la remarque E0213 pour toutes les lignes dans le scope
# pylint: disable=E0213
@validator("SQLALCHEMY_DATABASE_URI", pre=True) 
```

#### Formateur : isort et Black

Formate automatiquement le code lors de l'enregistrement du fichier.

Attention, les imports sont réorganisés automatiquement. Dans certains cas, nous souhaitons maintenir un ordre précis. Pour désactiver la réorganisation des imports :
- Fichier complet : ajouter `# isort: skip_file` après la docstring du module.
- Bloc spécifique : encadrer les lignes avec les commentaires `# isort: off` et `# isort: on`.

[Documentation isort sur les méthode de désactivation](https://pycqa.github.io/isort/docs/configuration/action_comments.html)